# LiveKit API Proxy for /recordings path
# Add this to your existing Apache configuration for api.hrdeedu.co.kr

<VirtualHost *:443>
    ServerName api.hrdeedu.co.kr
    DocumentRoot /var/www/html
    
    # SSL Configuration (use your existing SSL)
    SSLEngine on
    SSLCertificateFile /path/to/your/existing/certificate.crt
    SSLCertificateKeyFile /path/to/your/existing/private.key
    
    # Existing API configuration
    # ... your existing GraphQL API configuration ...
    
    # LiveKit API Proxy - Path-based routing for /recordings
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Forward /recordings/* to LiveKit
    ProxyPass /recordings/ http://localhost:7880/
    ProxyPassReverse /recordings/ http://localhost:7880/
    
    # Forward /recordings/rtc to LiveKit WebSocket
    ProxyPass /recordings/rtc ws://localhost:7881/rtc
    ProxyPassReverse /recordings/rtc ws://localhost:7881/rtc
    
    # Forward /recordings/twirp to LiveKit API
    ProxyPass /recordings/twirp http://localhost:7880/twirp
    ProxyPassReverse /recordings/twirp http://localhost:7880/twirp
    
    # Headers for proper forwarding
    ProxyAddHeaders On
    
    # CORS headers for cross-origin requests
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    
    # Handle preflight requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^recordings/(.*)$ recordings/$1 [R=200,L]
</VirtualHost>

